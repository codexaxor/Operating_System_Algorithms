#include "bits/stdc++.h"
#define rd freopen("ip.txt","r",stdin)
#define wr freopen("op.txt", "w", stdout)
#define wis(x) cout << #x << " ---> " << x << endl;
using namespace std;

/// LRU

int pointer;
int faults;


int predict(int reference_length, int references[], int page_no , int frame_size, int frame[], int start)
{
    int pos = -1, farthest = start, i;
    for (i = 0; i < frame_size; i++)
    {
        int j;
        for (j = start - 1; j >= 0; j--)
        {
            if (frame[i] == references[j])
            {
                if (j < farthest)
                {
                    farthest = j;
                    pos = i;
                }
                break;
            }
        }
        if (j == -1)
            return i;
    }

    return pos;
}

void add_reference(int frame_size, int frame[], int reference, int current_position, int reference_length, int references[])
{
    int i;
    bool allocated = false;
    for (i = 0; i < frame_size; i++)
    {

        if (frame[i] == reference)
        {
            allocated = true;
            break;
        }
        else if (frame[i] == -1)
        {
            frame[i] = reference;

            faults++;
            allocated = true;
            break;
        }
    }
    if (allocated == false)
    {
        int j = predict(reference_length, references, current_position, frame_size, frame, current_position + 1);

        frame[j] = reference;
        faults++;
    }
}

int main()
{
    
    int frame_size, i, number_of_references;
    printf("Enter frame size: ");
    scanf("%d", &frame_size);
    printf("\n");
    int frame[frame_size];
    for (i = 0; i < frame_size; i++)
    {
        frame[i] = -1;
    }

    printf("Enter the number of references: ");
    scanf("%d", &number_of_references);
    printf("\n");
    int reference[number_of_references];

    for (i = 0; i < number_of_references; i++)
    {
        scanf("%d", &reference[i]);
        add_reference(frame_size, frame, reference[i], i, number_of_references, reference);
    }
    printf("Number of faults using LRU Page Replacement Algorithm : %d\n", faults);
    printf("Page Fault Rate : %d", (int)ceil((faults*100*1.0)/number_of_references));
    cout<<"%"<<endl;
}
